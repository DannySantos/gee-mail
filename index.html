<html>
	<head>

		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
	    <script>

	    window.onload = function(){
	        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
	        // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser

	        // Declare variable to store the emails & formatting in
	        var messages;

	        // Function to change format of the date for display purposes
	        function getFormattedDate(date) {
			  var year = date.getFullYear();
			  var month = (1 + date.getMonth()).toString();
			  month = month.length > 1 ? month : '0' + month;
			  var day = date.getDate().toString();
			  day = day.length > 1 ? day : '0' + day;
			  return month + '/' + day + '/' + year;
			}

			// Function to loop through the geemails object and add rows to the messages variable
	        function displayRows() {
	        	for (var i = geemails.length - 1; i >= 0; i--) {
	        		if (typeof messages == 'undefined') {
		        		messages = "<div id=\"message" + i + "\" class=\"message-row\" onclick=\"showMessage('message" + i + "')\"><input type=\"checkbox\"><a href=\"#popup\"><span>" + 
		        					geemails[i].sender + 
		        					"</span><div><span>" + 
		        					geemails[i].subject + 
		        					"</span> - <span>" + 
		        					geemails[i].body.substring(0, 80) + 
		        					"...</span></div><span>" + 
		        					getFormattedDate(geemails[i].date) + 
		        					"</span></a></div>";
	        		} else {
		        		messages += "<div id=\"message" + i + "\" class=\"message-row\" onclick=\"showMessage('message" + i + "')\"><input type=\"checkbox\"><a href=\"#popup\"><span>" + 
		        					geemails[i].sender + 
		        					"</span><div><span>" + 
		        					geemails[i].subject + 
		        					"</span> - <span>" + 
		        					geemails[i].body.substring(0, 80) + 
		        					"...</span></div><span>" + 
		        					getFormattedDate(geemails[i].date) + 
		        					"</span></a></div>";
		        	}
	        	}
	        }

	        displayRows();

	        // Place the messages into the HTML
	        document.getElementById("displayMessages").innerHTML = messages;

	        // Place the inbox count into the HTML
	        document.getElementById("inboxCount").innerHTML = "1-" + geemails.length + " of " + geemails.length;


	        var intervalCounter = 10;

	        setInterval(function(){ 

	        	var newMessage = getNewMessage();
	        	geemails.push(newMessage);

	        	messages = [];

	        	displayRows()

	        	document.getElementById("displayMessages").innerHTML = messages;
	       		
	       		document.getElementById("inboxCount").innerHTML = "1-" + geemails.length + " of " + geemails.length;

	        	intervalCounter++;

	        	console.log(messages.length);

	        }, 15000);

	    };

	    /////////////////////////////////////////////////////////////////////
	    //     HAD TO MOVE THESE THINGS OUTSIDE OF THE ONLOAD FUNCTION     //
	    /////////////////////////////////////////////////////////////////////

	    // Declare variable to store contents of the email as shown by the popup
        var showMessagesArray = [];

        // Fill array with contents using message row div IDs as keys
		for(i = 0; i < geemails.length; i++) {
			showMessagesArray['message' + i] = "<h3>" + geemails[i].sender + "</h3>" +
	        									"<p>" + geemails[i].subject + "</p>" + 
	        									"<p>" + geemails[i].body + "</p>" + 
	        									"<p>" + geemails[i].date + "</p>";
		}

        // Function to replace content of the popup to the relevant array value. Activated by the onClick event assigned in displayRows
		function showMessage(divId) {
			document.getElementById('popupContent').innerHTML = showMessagesArray[divId];
		}

	    </script>

	</head>
	<body>

		<div class="container" id="main">
			
			<header>

			<h1>
				<a href="">
					<img src="images/geemail-logo.png" alt="Geemail Logo">
				</a>
			</h1>

			</header>

			<div>
				
				<h2 class="left-submenu-content">Mail</h2>

				<div class="center-submenu-content">
					<a href="#" alt="select"><input type="checkbox"></a>
					<a href="index.html" alt="refresh"><img src="images/icon-refresh.png" alt="Refresh"></a>
					<a href="#" alt="more">More</a>
				</div>

				<div class="right-submenu-content">
					<a href="#" alt="settings"><img src="images/icon-settings.png" alt="Settings"></a>

					<a href="#" alt="older">&gt;</a>
					<a href="#" alt="newer">&lt;</a>

					<span id="inboxCount">1-50 of 50</span>
				</div>

			</div>

			<div class="sidebar">

				<ul>
					<li><a href="#">Inbox</a></li>
					<li><a href="#">Starred</a></li>
					<li><a href="#">Sent Mail</a></li>
					<li><a href="#">Drafts</a></li>
					<li><a href="#">Important</a></li>
					<li><a href="#">Chats</a></li>
					<li><a href="#">All Mail</a></li>
					<li><a href="#">Spam</a></li>
					<li><a href="#">Trash</a></li>
				</ul>

				<ul>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
					<li><a href="#"></a></li>
				</ul>

			</div>

			<div class="content">

				<div id="displayMessages">

					<!-- displayRows populates this with email contents -->

				</div>

			</div>

		</div>

		<div id="popup" class="overlay">

			<div class="popup">
				
				<a class="close" href="#">x</a>

					<div id="popupContent">

						<!-- showMessage populates this with email contents -->

					</div>

			</div>

		</div>

	</body>
</html>